{% extends 'base.html' %}
{% set patient_records = patient.getRecords() %}

{% block Title %} {{ patient.lastname }} {{ patient.firstname }} {% endblock %}

{% block Style %}
	{{ parent() }}
	<link href="resources/style/patient.css" type="text/css" rel="stylesheet" media="all" />
{% endblock %}

{% block ContentLeftStyle %}width:360px;{% endblock %}
{% block ContentLeft %}
	<h3>{{ patient.lastname|title }} {{ patient.firstname|title }}</h3>
	<hr />
	<table>
		<tr>
			<td width="130px">Nume:</td>
			<td>{{ patient.lastname | title}}</td>
		</tr>
		<tr>
			<td>Prenume:</td>
			<td>{{ patient.firstname | title}}</td>
		</tr>
		<tr>
			<td>Sex:</td>
			<td>{{ patient.getGender() }}</td>
		</tr>
		<tr>
			<td>Data nasterii:</td>
			<td>{{ patient.getBirthDate() }}</td>
		</tr>
		<tr>
			<td>CNP:</td>
			<td>{{ patient.cnp }}</td>
		</tr>
		<tr>
			<td>Adaugat de:</td>
			<td>{{ patient.getParent() }}</td>
		</tr>
		<tr>
			<td>Ultima actualizare:</td>
			<td>{{ patient.updated | date("d.m.Y H:i:s")}}</td>
		</tr>
	</table>
{% endblock %}

{% block ContentRightStyle %}width:540px;{% endblock %}
{% block ContentRight %}

	{% include 'records_table.html' with {'records': patient_records} %}
	
	<br />
	<div id="add_new_record">
		<h4>Adauga o fisa noua</h4>
		<hr />
		<form action="resources/scripts/phpscripts/add_record.php" method="post" id="addRecordForm">
			<input type="hidden" name="patient" value="{{ patient.id }}" />
			<table>
				<tr>
					<td>Diagnostic de trimitere:</td>
					<td><input type="text" name="sending_diagnosis" /></td>
				</tr>
				<tr>
					<td>Medic:</td>
					<td><input type="text" name="sending_medic" /></td>
				</tr>
				<tr>
					<td>Investigatie:</td>
					<td>
						<select name = "investigation">
							<option value = ""> alege o optiune </option>
							<option value = "scintigrama osoasa">scintigrama osoasa</option>
							<option value = "scintigrama tiroidiana">scintigrama tiroidiana</option>
							<option value = "scintigrama paratiroidiana">scintigrama paratiroidiana</option>
							<option value = "scintigrama hepatica">scintigrama hepatica</option>
							<option value = "scintigrama renala">scintigrama renala</option>
							<option value = "scintigrama pulmonara">scintigrama pulmonara</option>
							<option value = "scintigrama de cord">scintigrama de cord</option>
							<option value = "diverse">diverse</option>
						</select>
					</td>
				</tr>
				<tr>
					<td>Clinica:</td>
					<td><input type="text" name="clinic" /></td>
				</tr>
				<tr>
					<td style="vertical-align: top;">Taguri:</td>
					<td>
						<input type="text" name="tag" id="tag_input" /><br />
						<input type="hidden" name="tags" id="tags_hidden" />
						<div id="tags"></div>
					</td>
				</tr>
			</table>
			<input type="submit" value="Adauga" class="btn" />
		</form>	
	</div>
{% endblock %}

{% block Bottom %}
	{{ parent() }}
	<script type="text/javascript" src="resources/scripts/jscripts/utils.js"></script>
	<script type="text/javascript">
		$(function () {
			$('#addRecordForm').validate({
				rules: {
					sending_diagnosis: "required",
					sending_medic: "required",
					investigation: "required",
					clinic: "required",
				},
				messages: {
					sending_diagnosis: "Introdu diagnosticul de trimitere",
					sending_medic: "Completeaza numele medicului",
					investigation: "Introdu investigatia facuta",
					clinic: "Introdu numele clinicii",
				}
			});
			
			$('#tag_input').autocomplete({
				source: [
					'gusa nodulara', 'adenom', 'fara noduli', 'tiroidita', 'boala Basedow', 'neoplasm tiroidian', 'carcinom', 'MTS',
					'nodul unic', 'gusa multinodulara',
					'afixator', 'hiperfixator', 'hipofixator', 'hipo-afixator',
					'hiperfixare difuza', 'hipofixare difuza',
					'omogen', 'eterogen',
					'ectopic',
					'piramida Lalouette',
					'postoperator',
					
					'feminin (F)', 'masculin (M)',
					'sub tratament', 'fara tratament',
					'99mTc', 'MIBI', 'Tetrofosmin', '131I',
					'SPECT', 'corp intreg', 'OAD', 'OAS',
					
					'metastaza unica', 'metastaze multiple',
					'osteolitic', 'osteocondensant',
					'fara metastaze',
					'eterogenitate',
					'punct de plecare neprecizat',
					'stern', 'vertebral', 'coaste', 'bazin', 'femur', 'humerus', 'articulatii', 'craniu', 'omoplat',
					'cancer', 'neoplasm mamar', 'prostata', 'tiroidian', 'uterin', 'renal', 'pulmonar', 'MTS', 'diseminari secundare', 'Paget', 'osteomielita', 'sacroileita', 'osteoporoza',
					'comparativ',
					'in evolutie',
					
					'Medronate', 'HDP', 'MDP', 'MIBI', 'Tetrofosmin',
					'SPECT', 'corp intreg', 'os 3 faze', 'precoce', 'tardiv',
					'stern', 'vertebral', 'coaste', 'bazin', 'oase lungi',
				],
				
				//define select handler  
				select: function(e, ui) {  
								  
					//create formatted tag  
					var tag = ui.item.value, 
						span = $('<span class="tag">').text(tag),  
						a = $("<a>").addClass("remove").attr({  
							href: "javascript:",  
							title: "Remove " + tag  
						}).text("x").appendTo(span);
						
						// add tag, after input
						$('#tags').append(span);
						$('#tags_hidden').val($('#tags_hidden').val() + (',' + tag + ','));
					},  
							  
				//define select handler  
				change: function() {  
							  
					//prevent 'to' field being updated and correct position  
					$("#tag_input").val("").css("top", 2);  
				}  
			});
							  
			//add live handler for clicks on remove links  
			$('body').on('click', 'span .remove', function(){
				//remove current tag  
				
				var tag = $(this).parent().text();
				tag = tag.substr(0, tag.length - 1)
				
				var tags = $('#tags_hidden').val();				
				tags = tags.replace(',' + tag + ',', '');
				
				$('#tags_hidden').val(tags);
				$(this).parent().remove();
								  
				//correct 'to' field position  
				if($("#tags span").length === 0) {  
					$("#tag_input").css("top", 0);  
				}                 
			});
		});
	</script>
{% endblock %}
